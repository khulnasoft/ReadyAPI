
<!doctype html>
<html lang="de" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="ReadyAPI framework, high performance, easy to learn, fast to code, ready for production">
      
      
      
        <link rel="canonical" href="https://readyapi.khulnasoft.com/de/how-to/sql-databases-peewee/">
      
      
        <link rel="prev" href="../configure-swagger-ui/">
      
      
        <link rel="next" href="../async-sql-encode-databases/">
      
      
      <link rel="icon" href="../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.18">
    
    
      
        <title>~~SQL (Relational) Databases with Peewee~~ (deprecated) - ReadyAPI</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/termynal.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-YNEVN69SC3"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-YNEVN69SC3",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-YNEVN69SC3",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sql-relational-databases-with-peewee-deprecated" class="md-skip">
          Zum Inhalt
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
<div class="announce-wrapper">
  <div id="announce-left">
    <div class="item">
      <a class="announce-link" href="https://twitter.com/readyapi" target="_blank">
        <span class="twemoji twitter">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
        </span> Follow <strong>@readyapi</strong> on <strong>Twitter</strong> to stay updated
      </a>
    </div>
    <div class="item">
      <a class="announce-link" href="https://readyapi.khulnasoft.com/newsletter/">
        <span class="twemoji">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Z"/></svg>
        </span> Subscribe to the <strong>ReadyAPI and friends</strong> newsletter üéâ
      </a>
    </div>
    <div class="item">
      <iframe style="display: inline-block; vertical-align: middle; border: none; margin-right: 0.5rem;" src="https://github.com/sponsors/khulnasoft/button" title="Sponsor khulnasoft" height="35" width="116" style="border: 0;"></iframe> <a class="announce-link" target="_blank" href="https://github.com/sponsors/khulnasoft">You can now sponsor <strong>ReadyAPI</strong> üç∞</a>
    </div>
  </div>
  <div id="announce-right" style="position: relative;">
    <div class="item">
      <a title="CryptAPI: Your easy to use, secure and privacy oriented payment gateway." style="display: block; position: relative;" href="https://cryptapi.io/" target="_blank">
        <span class="sponsor-badge">sponsor</span>
        <img class="sponsor-image" src="/img/sponsors/cryptapi-banner.svg" />
      </a>
    </div>
    <div class="item">
      <a title="Build, run and scale your apps on a modern, reliable, and secure PaaS." style="display: block; position: relative;" href="https://platform.sh/try-it-now/?utm_source=readyapi-signup&utm_medium=banner&utm_campaign=ReadyAPI-signup-June-2023" target="_blank">
        <span class="sponsor-badge">sponsor</span>
        <img class="sponsor-image" src="/img/sponsors/platform-sh-banner.png" />
      </a>
    </div>
    <div class="item">
      <a title="Deploy ReadyAPI on AWS with a few clicks" style="display: block; position: relative;" href="https://www.porter.run" target="_blank">
        <span class="sponsor-badge">sponsor</span>
        <img class="sponsor-image" src="/img/sponsors/porter-banner.png" />
      </a>
    </div>
    <div class="item">
      <a title="Automate ReadyAPI documentation generation with Bump.sh" style="display: block; position: relative;" href="https://bump.sh/readyapi?utm_source=readyapi&utm_medium=referral&utm_campaign=sponsor" target="_blank">
        <span class="sponsor-badge">sponsor</span>
        <img class="sponsor-image" src="/img/sponsors/bump-sh-banner.svg" />
      </a>
    </div>
    <div class="item">
      <a title="Reflex" style="display: block; position: relative;" href="https://reflex.dev" target="_blank">
        <span class="sponsor-badge">sponsor</span>
        <img class="sponsor-image" src="/img/sponsors/reflex-banner.png" />
      </a>
    </div>
    <div class="item">
      <a title="Scalar: Beautiful Open-Source API References from Swagger/OpenAPI files" style="display: block; position: relative;" href="https://github.com/scalar/scalar/?utm_source=readyapi&utm_medium=website&utm_campaign=top-banner" target="_blank">
        <span class="sponsor-badge">sponsor</span>
        <img class="sponsor-image" src="/img/sponsors/scalar-banner.svg" />
      </a>
    </div>
    <div class="item">
      <a title="Auth, user management and more for your B2B product" style="display: block; position: relative;" href="https://www.propelauth.com/?utm_source=readyapi&utm_campaign=1223&utm_medium=topbanner" target="_blank">
        <span class="sponsor-badge">sponsor</span>
        <img class="sponsor-image" src="/img/sponsors/propelauth-banner.png" />
      </a>
    </div>
    <div class="item">
      <a title="Coherence" style="display: block; position: relative;" href="https://www.withcoherence.com/?utm_medium=advertising&utm_source=readyapi&utm_campaign=banner%20january%2024" target="_blank">
        <span class="sponsor-badge">sponsor</span>
        <img class="sponsor-image" src="/img/sponsors/coherence-banner.png" />
      </a>
    </div>
    <div class="item">
      <a title="Build your next app with ReadyAPI and MongoDB" style="display: block; position: relative;" href="https://www.mongodb.com/developer/languages/python/python-quickstart-readyapi/?utm_campaign=readyapi_framework&utm_source=readyapi_sponsorship&utm_medium=web_referral" target="_blank">
        <span class="sponsor-badge">sponsor</span>
        <img class="sponsor-image" src="/img/sponsors/mongodb-banner.png" />
      </a>
    </div>
  </div>
</div>

          </div>
          
        </aside>
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Kopfzeile">
    <a href="../.." title="ReadyAPI" class="md-header__button md-logo" aria-label="ReadyAPI" data-md-component="logo">
      
  <img src="../../img/icon-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ReadyAPI
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ~~SQL (Relational) Databases with Peewee~~ (deprecated)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Sprache wechseln">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/" hreflang="" class="md-select__link">
              en - English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/az/" hreflang="" class="md-select__link">
              az - az…ôrbaycan dili
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/bn/" hreflang="" class="md-select__link">
              bn - ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/de/" hreflang="" class="md-select__link">
              de - Deutsch
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/es/" hreflang="" class="md-select__link">
              es - espa√±ol
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/fa/" hreflang="" class="md-select__link">
              fa - ŸÅÿßÿ±ÿ≥€å
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/fr/" hreflang="" class="md-select__link">
              fr - fran√ßais
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/he/" hreflang="" class="md-select__link">
              he - ◊¢◊ë◊®◊ô◊™
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/hu/" hreflang="" class="md-select__link">
              hu - magyar
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/id/" hreflang="" class="md-select__link">
              id - Bahasa Indonesia
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/it/" hreflang="" class="md-select__link">
              it - italiano
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/ja/" hreflang="" class="md-select__link">
              ja - Êó•Êú¨Ë™û
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/ko/" hreflang="" class="md-select__link">
              ko - ÌïúÍµ≠Ïñ¥
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/pl/" hreflang="" class="md-select__link">
              pl - Polski
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/pt/" hreflang="" class="md-select__link">
              pt - portugu√™s
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/ru/" hreflang="" class="md-select__link">
              ru - —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/tr/" hreflang="" class="md-select__link">
              tr - T√ºrk√ße
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/uk/" hreflang="" class="md-select__link">
              uk - —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/ur/" hreflang="" class="md-select__link">
              ur - ÿßÿ±ÿØŸà
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/vi/" hreflang="" class="md-select__link">
              vi - Ti·∫øng Vi·ªát
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/yo/" hreflang="" class="md-select__link">
              yo - Yor√πb√°
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/zh/" hreflang="" class="md-select__link">
              zh - ÁÆÄ‰Ωì‰∏≠Êñá
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/zh-hant/" hreflang="" class="md-select__link">
              zh-hant - ÁπÅÈ´î‰∏≠Êñá
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/em/" hreflang="" class="md-select__link">
              üòâ
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Suche" placeholder="Suche" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Suche">
        
        <button type="reset" class="md-search__icon md-icon" title="Zur√ºcksetzen" aria-label="Zur√ºcksetzen" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Suche wird initialisiert
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/khulnasoft/readyapi" title="Zum Repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    khulnasoft/readyapi
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Hauptnavigation" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  ReadyAPI

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../features/" class="md-tabs__link">
        
  
    
  
  Merkmale

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../learn/" class="md-tabs__link">
          
  
    
  
  Lernen

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/" class="md-tabs__link">
          
  
    
  
  Referenz ‚Äì Code-API

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../readyapi-people/" class="md-tabs__link">
        
  
    
  
  ReadyAPI Leute

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../resources/" class="md-tabs__link">
          
  
    
  
  Ressourcen

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../about/" class="md-tabs__link">
          
  
    
  
  √úber

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../help/" class="md-tabs__link">
          
  
    
  
  Hilfe

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../release-notes/" class="md-tabs__link">
        
  
    
  
  Release Notes

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ReadyAPI" class="md-nav__button md-logo" aria-label="ReadyAPI" data-md-component="logo">
      
  <img src="../../img/icon-white.svg" alt="logo">

    </a>
    ReadyAPI
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/khulnasoft/readyapi" title="Zum Repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    khulnasoft/readyapi
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReadyAPI
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Merkmale
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../learn/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Lernen
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Lernen
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python-types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Einf√ºhrung in Python-Typen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../async/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nebenl√§ufigkeit und async / await
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tutorial/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tutorial ‚Äì Benutzerhandbuch
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorial ‚Äì Benutzerhandbuch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/first-steps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Erste Schritte
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/path-params/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pfad-Parameter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/query-params/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query-Parameter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/body/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Requestbody
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/query-params-str-validations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query-Parameter und Stringvalidierung
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/path-params-numeric-validations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pfad-Parameter und Validierung von Zahlen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/body-multiple-params/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Body ‚Äì Mehrere Parameter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/body-fields/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Body ‚Äì Felder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/body-nested-models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Body ‚Äì Verschachtelte Modelle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/schema-extra-example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Beispiel-Request-Daten deklarieren
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/extra-data-types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zus√§tzliche Datentypen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/cookie-params/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cookie-Parameter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/header-params/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Header-Parameter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/response-model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Responsemodell ‚Äì R√ºckgabetyp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/extra-models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extramodelle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/response-status-code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Response-Statuscode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/request-forms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Formulardaten
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/request-files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dateien im Request
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/request-forms-and-files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Formulardaten und Dateien im Request
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/handling-errors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fehlerbehandlung
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/path-operation-configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pfadoperation-Konfiguration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/encoder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JSON-kompatibler Encoder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/body-updates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Body ‚Äì Aktualisierungen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_25" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tutorial/dependencies/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Abh√§ngigkeiten
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4_25" id="__nav_3_4_25_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_25_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_25">
            <span class="md-nav__icon md-icon"></span>
            Abh√§ngigkeiten
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/dependencies/classes-as-dependencies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Klassen als Abh√§ngigkeiten
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/dependencies/sub-dependencies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unterabh√§ngigkeiten
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/dependencies/dependencies-in-path-operation-decorators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abh√§ngigkeiten in Pfadoperation-Dekoratoren
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/dependencies/global-dependencies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Globale Abh√§ngigkeiten
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/dependencies/dependencies-with-yield/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abh√§ngigkeiten mit yield
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_26" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tutorial/security/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Sicherheit
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4_26" id="__nav_3_4_26_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_26_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_26">
            <span class="md-nav__icon md-icon"></span>
            Sicherheit
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/security/first-steps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sicherheit ‚Äì Erste Schritte
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/security/get-current-user/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aktuellen Benutzer abrufen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/security/simple-oauth2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Einfaches OAuth2 mit Password und Bearer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/security/oauth2-jwt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OAuth2 mit Password (und Hashing), Bearer mit JWT-Tokens
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/middleware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Middleware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/cors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CORS (Cross-Origin Resource Sharing)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/sql-databases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL (Relational) Databases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/bigger-applications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gr√∂√üere Anwendungen ‚Äì mehrere Dateien
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/background-tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hintergrundtasks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metadaten und URLs der Dokumentationen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/static-files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Statische Dateien
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debugging
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../advanced/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Handbuch f√ºr fortgeschrittene Benutzer
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Handbuch f√ºr fortgeschrittene Benutzer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/path-operation-advanced-configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fortgeschrittene Konfiguration der Pfadoperation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/additional-status-codes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zus√§tzliche Statuscodes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/response-directly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Eine Response direkt zur√ºckgeben
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/custom-response/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Benutzerdefinierte Response ‚Äì HTML, Stream, Datei, andere
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/additional-responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zus√§tzliche Responses in OpenAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/response-cookies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Response-Cookies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/response-headers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Response-Header
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/response-change-status-code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Response ‚Äì Statuscode √§ndern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/advanced-dependencies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fortgeschrittene Abh√§ngigkeiten
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../advanced/security/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Fortgeschrittene Sicherheit
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5_11" id="__nav_3_5_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_11">
            <span class="md-nav__icon md-icon"></span>
            Fortgeschrittene Sicherheit
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/security/oauth2-scopes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OAuth2-Scopes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/security/http-basic-auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTP Basic Auth
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/using-request-directly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Den Request direkt verwenden
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/dataclasses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Verwendung von Datenklassen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/middleware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fortgeschrittene Middleware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/sub-applications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unteranwendungen ‚Äì Mounts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/behind-a-proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hinter einem Proxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/templates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/websockets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WebSockets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lifespan-Events
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/testing-websockets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WebSockets testen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/testing-events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Events testen: Hochfahren ‚Äì Herunterfahren
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/testing-dependencies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testen mit Ersatz f√ºr Abh√§ngigkeiten
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/testing-database/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing a Database
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/async-tests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Asynchrone Tests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Einstellungen und Umgebungsvariablen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/openapi-callbacks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenAPI-Callbacks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/openapi-webhooks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenAPI-Webhooks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/wsgi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WSGI inkludieren ‚Äì Flask, Django und andere
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/generate-clients/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Clients generieren
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../deployment/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Deployment
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/versions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    √úber ReadyAPI-Versionen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/https/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    √úber HTTPS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/manually/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Einen Server manuell ausf√ºhren ‚Äì Uvicorn
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment-Konzepte
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/cloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReadyAPI-Deployment bei Cloud-Anbietern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/server-workers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serverworker ‚Äì Gunicorn mit Uvicorn
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReadyAPI in Containern ‚Äì Docker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    How-To ‚Äì Rezepte
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            How-To ‚Äì Rezepte
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../general/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Allgemeines ‚Äì How-To ‚Äì Rezepte
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graphql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GraphQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom-request-and-route/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Benutzerdefinierte Request- und APIRoute-Klasse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../conditional-openapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bedingte OpenAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extending-openapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenAPI erweitern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../separate-openapi-schemas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Separate OpenAPI-Schemas f√ºr Eingabe und Ausgabe oder nicht
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom-docs-ui-assets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Statische Assets der Dokumentationsoberfl√§che (selbst hosten)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configure-swagger-ui/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Swagger-Oberfl√§che konfigurieren
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    ~~SQL (Relational) Databases with Peewee~~ (deprecated)
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    ~~SQL (Relational) Databases with Peewee~~ (deprecated)
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#peewee-for-async" class="md-nav__link">
    <span class="md-ellipsis">
      Peewee for async
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-same-app" class="md-nav__link">
    <span class="md-ellipsis">
      The same app
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-structure" class="md-nav__link">
    <span class="md-ellipsis">
      File structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-peewee-parts" class="md-nav__link">
    <span class="md-ellipsis">
      Create the Peewee parts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create the Peewee parts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-standard-peewee-code" class="md-nav__link">
    <span class="md-ellipsis">
      The standard Peewee code
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The standard Peewee code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-peewee-async-compatible-peeweeconnectionstate" class="md-nav__link">
    <span class="md-ellipsis">
      Make Peewee async-compatible PeeweeConnectionState
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-the-custom-peeweeconnectionstate-class" class="md-nav__link">
    <span class="md-ellipsis">
      Use the custom PeeweeConnectionState class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-database-models" class="md-nav__link">
    <span class="md-ellipsis">
      Create the database models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create the database models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-peewee-models-for-our-data" class="md-nav__link">
    <span class="md-ellipsis">
      Create Peewee models for our data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-pydantic-models" class="md-nav__link">
    <span class="md-ellipsis">
      Create the Pydantic models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create the Pydantic models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-pydantic-models-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      Create the Pydantic models / schemas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-peeweegetterdict-for-the-pydantic-models-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      Create a PeeweeGetterDict for the Pydantic models / schemas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crud-utils" class="md-nav__link">
    <span class="md-ellipsis">
      CRUD utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CRUD utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-all-the-crud-utils" class="md-nav__link">
    <span class="md-ellipsis">
      Create all the CRUD utils
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-readyapi-app" class="md-nav__link">
    <span class="md-ellipsis">
      Main ReadyAPI app
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Main ReadyAPI app">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-database-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Create the database tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-dependency" class="md-nav__link">
    <span class="md-ellipsis">
      Create a dependency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#context-variable-sub-dependency" class="md-nav__link">
    <span class="md-ellipsis">
      Context variable sub-dependency
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Context variable sub-dependency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#peewee-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      Peewee Proxy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-your-readyapi-path-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Create your ReadyAPI path operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#about-def-vs-async-def" class="md-nav__link">
    <span class="md-ellipsis">
      About def vs async def
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-peewee-with-async" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Peewee with async
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Peewee with async">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-happens" class="md-nav__link">
    <span class="md-ellipsis">
      What happens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-peewee-with-readyapi" class="md-nav__link">
    <span class="md-ellipsis">
      Fix Peewee with ReadyAPI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#review-all-the-files" class="md-nav__link">
    <span class="md-ellipsis">
      Review all the files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technical-details" class="md-nav__link">
    <span class="md-ellipsis">
      Technical Details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Technical Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-problem" class="md-nav__link">
    <span class="md-ellipsis">
      The problem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#context-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Context variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-context-variables-in-the-async-dependency-reset_db_state" class="md-nav__link">
    <span class="md-ellipsis">
      Set context variables in the async dependency reset_db_state()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-database-state-in-the-dependency-get_db" class="md-nav__link">
    <span class="md-ellipsis">
      Set database state in the dependency get_db()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connect-and-disconnect-in-the-dependency-get_db" class="md-nav__link">
    <span class="md-ellipsis">
      Connect and disconnect in the dependency get_db()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../async-sql-encode-databases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ~~Async SQL (Relational) Databases with Encode/Databases~~ (deprecated)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nosql-databases-couchbase/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ~~NoSQL (Distributed / Big Data) Databases with Couchbase~~ (deprecated)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Referenz ‚Äì Code-API
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Referenz ‚Äì Code-API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/readyapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    `ReadyAPI`-Klasse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/parameters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Request-Parameter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/status/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Statuscodes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/uploadfile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    `UploadFile`-Klasse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/exceptions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exceptions ‚Äì `HTTPException` und `WebSocketException`
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/dependencies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Abh√§ngigkeiten ‚Äì `Depends()` und `Security()`
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/apirouter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    `APIRouter`-Klasse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/background/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hintergrundtasks ‚Äì `BackgroundTasks`
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/request/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    `Request`-Klasse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/websockets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WebSockets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/httpconnection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    `HTTPConnection`-Klasse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/response/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    `Response`-Klasse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Benutzerdefinierte Responseklassen ‚Äì File, HTML, Redirect, Streaming, usw.
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/middleware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Middleware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_16" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/openapi/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    OpenAPI
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_16" id="__nav_4_16_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_16">
            <span class="md-nav__icon md-icon"></span>
            OpenAPI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/openapi/docs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenAPI `docs`
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/openapi/models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenAPI-`models`
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sicherheitstools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/encoders/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Encoder ‚Äì `jsonable_encoder`
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/staticfiles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Statische Dateien ‚Äì `StaticFiles`
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/templating/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templating ‚Äì `Jinja2Templates`
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/testclient/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testclient ‚Äì `TestClient`
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../readyapi-people/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReadyAPI Leute
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../resources/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Ressourcen
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Ressourcen
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project-generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Projektgenerierung ‚Äì Vorlage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../external-links/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Externe Links und Artikel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../newsletter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReadyAPI und Freunde Newsletter
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../about/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    √úber
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            √úber
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../alternatives/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Alternativen, Inspiration und Vergleiche
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../history-design-future/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Geschichte, Design und Zukunft
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../benchmarks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Benchmarks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../help/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Hilfe
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Hilfe
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../help-readyapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReadyAPI helfen ‚Äì Hilfe erhalten
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entwicklung ‚Äì Mitwirken
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release Notes
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#peewee-for-async" class="md-nav__link">
    <span class="md-ellipsis">
      Peewee for async
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-same-app" class="md-nav__link">
    <span class="md-ellipsis">
      The same app
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-structure" class="md-nav__link">
    <span class="md-ellipsis">
      File structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-peewee-parts" class="md-nav__link">
    <span class="md-ellipsis">
      Create the Peewee parts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create the Peewee parts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-standard-peewee-code" class="md-nav__link">
    <span class="md-ellipsis">
      The standard Peewee code
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The standard Peewee code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note" class="md-nav__link">
    <span class="md-ellipsis">
      Note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-peewee-async-compatible-peeweeconnectionstate" class="md-nav__link">
    <span class="md-ellipsis">
      Make Peewee async-compatible PeeweeConnectionState
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-the-custom-peeweeconnectionstate-class" class="md-nav__link">
    <span class="md-ellipsis">
      Use the custom PeeweeConnectionState class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-database-models" class="md-nav__link">
    <span class="md-ellipsis">
      Create the database models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create the database models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-peewee-models-for-our-data" class="md-nav__link">
    <span class="md-ellipsis">
      Create Peewee models for our data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-pydantic-models" class="md-nav__link">
    <span class="md-ellipsis">
      Create the Pydantic models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create the Pydantic models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-pydantic-models-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      Create the Pydantic models / schemas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-peeweegetterdict-for-the-pydantic-models-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      Create a PeeweeGetterDict for the Pydantic models / schemas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crud-utils" class="md-nav__link">
    <span class="md-ellipsis">
      CRUD utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CRUD utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-all-the-crud-utils" class="md-nav__link">
    <span class="md-ellipsis">
      Create all the CRUD utils
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-readyapi-app" class="md-nav__link">
    <span class="md-ellipsis">
      Main ReadyAPI app
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Main ReadyAPI app">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-database-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Create the database tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-dependency" class="md-nav__link">
    <span class="md-ellipsis">
      Create a dependency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#context-variable-sub-dependency" class="md-nav__link">
    <span class="md-ellipsis">
      Context variable sub-dependency
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Context variable sub-dependency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#peewee-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      Peewee Proxy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-your-readyapi-path-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Create your ReadyAPI path operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#about-def-vs-async-def" class="md-nav__link">
    <span class="md-ellipsis">
      About def vs async def
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-peewee-with-async" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Peewee with async
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Peewee with async">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-happens" class="md-nav__link">
    <span class="md-ellipsis">
      What happens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-peewee-with-readyapi" class="md-nav__link">
    <span class="md-ellipsis">
      Fix Peewee with ReadyAPI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#review-all-the-files" class="md-nav__link">
    <span class="md-ellipsis">
      Review all the files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technical-details" class="md-nav__link">
    <span class="md-ellipsis">
      Technical Details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Technical Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-problem" class="md-nav__link">
    <span class="md-ellipsis">
      The problem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#context-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Context variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-context-variables-in-the-async-dependency-reset_db_state" class="md-nav__link">
    <span class="md-ellipsis">
      Set context variables in the async dependency reset_db_state()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-database-state-in-the-dependency-get_db" class="md-nav__link">
    <span class="md-ellipsis">
      Set database state in the dependency get_db()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connect-and-disconnect-in-the-dependency-get_db" class="md-nav__link">
    <span class="md-ellipsis">
      Connect and disconnect in the dependency get_db()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="sql-relational-databases-with-peewee-deprecated"><del>SQL (Relational) Databases with Peewee</del> (deprecated)<a class="headerlink" href="#sql-relational-databases-with-peewee-deprecated" title="Permanent link">&para;</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The current page still doesn't have a translation for this language.</p>
<p>But you can help translating it: <a class="internal-link" href="https://readyapi.khulnasoft.com/contributing/" target="_blank">Contributing</a>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Deprecated</p>
<p>This tutorial is deprecated and will be removed in a future version.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you are just starting, the tutorial <a class="internal-link" href="../../tutorial/sql-databases/" target="_blank">SQL (Relational) Databases</a> that uses SQLAlchemy should be enough.</p>
<p>Feel free to skip this.</p>
<p>Peewee is not recommended with ReadyAPI as it doesn't play well with anything async Python. There are several better alternatives.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>These docs assume Pydantic v1.</p>
<p>Because Pewee doesn't play well with anything async and there are better alternatives, I won't update these docs for Pydantic v2, they are kept for now only for historical purposes.</p>
<p>The examples here are no longer tested in CI (as they were before).</p>
</div>
<p>If you are starting a project from scratch, you are probably better off with SQLAlchemy ORM (<a class="internal-link" href="../../tutorial/sql-databases/" target="_blank">SQL (Relational) Databases</a>), or any other async ORM.</p>
<p>If you already have a code base that uses <a href="https://docs.peewee-orm.com/en/latest/" class="external-link" target="_blank">Peewee ORM</a>, you can check here how to use it with <strong>ReadyAPI</strong>.</p>
<div class="admonition warning">
<p class="admonition-title">Python 3.7+ required</p>
<p>You will need Python 3.7 or above to safely use Peewee with ReadyAPI.</p>
</div>
<h2 id="peewee-for-async">Peewee for async<a class="headerlink" href="#peewee-for-async" title="Permanent link">&para;</a></h2>
<p>Peewee was not designed for async frameworks, or with them in mind.</p>
<p>Peewee has some heavy assumptions about its defaults and about how it should be used.</p>
<p>If you are developing an application with an older non-async framework, and can work with all its defaults, <strong>it can be a great tool</strong>.</p>
<p>But if you need to change some of the defaults, support more than one predefined database, work with an async framework (like ReadyAPI), etc, you will need to add quite some complex extra code to override those defaults.</p>
<p>Nevertheless, it's possible to do it, and here you'll see exactly what code you have to add to be able to use Peewee with ReadyAPI.</p>
<div class="admonition note">
<p class="admonition-title">Technical Details</p>
<p>You can read more about Peewee's stand about async in Python <a href="https://docs.peewee-orm.com/en/latest/peewee/database.html#async-with-gevent" class="external-link" target="_blank">in the docs</a>, <a href="https://github.com/coleifer/peewee/issues/263#issuecomment-517347032" class="external-link" target="_blank">an issue</a>, <a href="https://github.com/coleifer/peewee/pull/2072#issuecomment-563215132" class="external-link" target="_blank">a PR</a>.</p>
</div>
<h2 id="the-same-app">The same app<a class="headerlink" href="#the-same-app" title="Permanent link">&para;</a></h2>
<p>We are going to create the same application as in the SQLAlchemy tutorial (<a class="internal-link" href="../../tutorial/sql-databases/" target="_blank">SQL (Relational) Databases</a>).</p>
<p>Most of the code is actually the same.</p>
<p>So, we are going to focus only on the differences.</p>
<h2 id="file-structure">File structure<a class="headerlink" href="#file-structure" title="Permanent link">&para;</a></h2>
<p>Let's say you have a directory named <code>my_super_project</code> that contains a sub-directory called <code>sql_app</code> with a structure like this:</p>
<div class="highlight"><pre><span></span><code>.
‚îî‚îÄ‚îÄ sql_app
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ crud.py
    ‚îú‚îÄ‚îÄ database.py
    ‚îú‚îÄ‚îÄ main.py
    ‚îî‚îÄ‚îÄ schemas.py
</code></pre></div>
<p>This is almost the same structure as we had for the SQLAlchemy tutorial.</p>
<p>Now let's see what each file/module does.</p>
<h2 id="create-the-peewee-parts">Create the Peewee parts<a class="headerlink" href="#create-the-peewee-parts" title="Permanent link">&para;</a></h2>
<p>Let's refer to the file <code>sql_app/database.py</code>.</p>
<h3 id="the-standard-peewee-code">The standard Peewee code<a class="headerlink" href="#the-standard-peewee-code" title="Permanent link">&para;</a></h3>
<p>Let's first check all the normal Peewee code, create a Peewee database:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">contextvars</span> <span class="kn">import</span> <span class="n">ContextVar</span>

<span class="hll"><span class="kn">import</span> <span class="nn">peewee</span>
</span>
<span class="hll"><span class="n">DATABASE_NAME</span> <span class="o">=</span> <span class="s2">&quot;test.db&quot;</span>
</span><span class="n">db_state_default</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;closed&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;conn&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;ctx&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;transactions&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
<span class="n">db_state</span> <span class="o">=</span> <span class="n">ContextVar</span><span class="p">(</span><span class="s2">&quot;db_state&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">db_state_default</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">PeeweeConnectionState</span><span class="p">(</span><span class="n">peewee</span><span class="o">.</span><span class="n">_ConnectionState</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_state&quot;</span><span class="p">,</span> <span class="n">db_state</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span>


<span class="hll"><span class="n">db</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">SqliteDatabase</span><span class="p">(</span><span class="n">DATABASE_NAME</span><span class="p">,</span> <span class="n">check_same_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span>
<span class="n">db</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">PeeweeConnectionState</span><span class="p">()</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Keep in mind that if you wanted to use a different database, like PostgreSQL, you couldn't just change the string. You would need to use a different Peewee database class.</p>
</div>
<h4 id="note">Note<a class="headerlink" href="#note" title="Permanent link">&para;</a></h4>
<p>The argument:</p>
<div class="highlight"><pre><span></span><code><span class="n">check_same_thread</span><span class="o">=</span><span class="kc">False</span>
</code></pre></div>
<p>is equivalent to the one in the SQLAlchemy tutorial:</p>
<div class="highlight"><pre><span></span><code><span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;check_same_thread&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</code></pre></div>
<p>...it is needed only for <code>SQLite</code>.</p>
<div class="admonition info">
<p class="admonition-title">Technical Details</p>
<p>Exactly the same technical details as in <a class="internal-link" href="../../tutorial/sql-databases/#note" target="_blank">SQL (Relational) Databases</a> apply.</p>
</div>
<h3 id="make-peewee-async-compatible-peeweeconnectionstate">Make Peewee async-compatible <code>PeeweeConnectionState</code><a class="headerlink" href="#make-peewee-async-compatible-peeweeconnectionstate" title="Permanent link">&para;</a></h3>
<p>The main issue with Peewee and ReadyAPI is that Peewee relies heavily on <a href="https://docs.python.org/3/library/threading.html#thread-local-data" class="external-link" target="_blank">Python's <code>threading.local</code></a>, and it doesn't have a direct way to override it or let you handle connections/sessions directly (as is done in the SQLAlchemy tutorial).</p>
<p>And <code>threading.local</code> is not compatible with the new async features of modern Python.</p>
<div class="admonition note">
<p class="admonition-title">Technical Details</p>
<p><code>threading.local</code> is used to have a "magic" variable that has a different value for each thread.</p>
<p>This was useful in older frameworks designed to have one single thread per request, no more, no less.</p>
<p>Using this, each request would have its own database connection/session, which is the actual final goal.</p>
<p>But ReadyAPI, using the new async features, could handle more than one request on the same thread. And at the same time, for a single request, it could run multiple things in different threads (in a threadpool), depending on if you use <code>async def</code> or normal <code>def</code>. This is what gives all the performance improvements to ReadyAPI.</p>
</div>
<p>But Python 3.7 and above provide a more advanced alternative to <code>threading.local</code>, that can also be used in the places where <code>threading.local</code> would be used, but is compatible with the new async features.</p>
<p>We are going to use that. It's called <a href="https://docs.python.org/3/library/contextvars.html" class="external-link" target="_blank"><code>contextvars</code></a>.</p>
<p>We are going to override the internal parts of Peewee that use <code>threading.local</code> and replace them with <code>contextvars</code>, with the corresponding updates.</p>
<p>This might seem a bit complex (and it actually is), you don't really need to completely understand how it works to use it.</p>
<p>We will create a <code>PeeweeConnectionState</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">contextvars</span> <span class="kn">import</span> <span class="n">ContextVar</span>

<span class="kn">import</span> <span class="nn">peewee</span>

<span class="n">DATABASE_NAME</span> <span class="o">=</span> <span class="s2">&quot;test.db&quot;</span>
<span class="n">db_state_default</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;closed&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;conn&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;ctx&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;transactions&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
<span class="n">db_state</span> <span class="o">=</span> <span class="n">ContextVar</span><span class="p">(</span><span class="s2">&quot;db_state&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">db_state_default</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>


<span class="hll"><span class="k">class</span> <span class="nc">PeeweeConnectionState</span><span class="p">(</span><span class="n">peewee</span><span class="o">.</span><span class="n">_ConnectionState</span><span class="p">):</span>
</span><span class="hll">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_state&quot;</span><span class="p">,</span> <span class="n">db_state</span><span class="p">)</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span class="hll">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span>
</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">SqliteDatabase</span><span class="p">(</span><span class="n">DATABASE_NAME</span><span class="p">,</span> <span class="n">check_same_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">db</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">PeeweeConnectionState</span><span class="p">()</span>
</code></pre></div>
<p>This class inherits from a special internal class used by Peewee.</p>
<p>It has all the logic to make Peewee use <code>contextvars</code> instead of <code>threading.local</code>.</p>
<p><code>contextvars</code> works a bit differently than <code>threading.local</code>. But the rest of Peewee's internal code assumes that this class works with <code>threading.local</code>.</p>
<p>So, we need to do some extra tricks to make it work as if it was just using <code>threading.local</code>. The <code>__init__</code>, <code>__setattr__</code>, and <code>__getattr__</code> implement all the required tricks for this to be used by Peewee without knowing that it is now compatible with ReadyAPI.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This will just make Peewee behave correctly when used with ReadyAPI. Not randomly opening or closing connections that are being used, creating errors, etc.</p>
<p>But it doesn't give Peewee async super-powers. You should still use normal <code>def</code> functions and not <code>async def</code>.</p>
</div>
<h3 id="use-the-custom-peeweeconnectionstate-class">Use the custom <code>PeeweeConnectionState</code> class<a class="headerlink" href="#use-the-custom-peeweeconnectionstate-class" title="Permanent link">&para;</a></h3>
<p>Now, overwrite the <code>._state</code> internal attribute in the Peewee database <code>db</code> object using the new <code>PeeweeConnectionState</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">contextvars</span> <span class="kn">import</span> <span class="n">ContextVar</span>

<span class="kn">import</span> <span class="nn">peewee</span>

<span class="n">DATABASE_NAME</span> <span class="o">=</span> <span class="s2">&quot;test.db&quot;</span>
<span class="n">db_state_default</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;closed&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;conn&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;ctx&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;transactions&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
<span class="n">db_state</span> <span class="o">=</span> <span class="n">ContextVar</span><span class="p">(</span><span class="s2">&quot;db_state&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">db_state_default</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">PeeweeConnectionState</span><span class="p">(</span><span class="n">peewee</span><span class="o">.</span><span class="n">_ConnectionState</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_state&quot;</span><span class="p">,</span> <span class="n">db_state</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span>


<span class="n">db</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">SqliteDatabase</span><span class="p">(</span><span class="n">DATABASE_NAME</span><span class="p">,</span> <span class="n">check_same_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="hll"><span class="n">db</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">PeeweeConnectionState</span><span class="p">()</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Make sure you overwrite <code>db._state</code> <em>after</em> creating <code>db</code>.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You would do the same for any other Peewee database, including <code>PostgresqlDatabase</code>, <code>MySQLDatabase</code>, etc.</p>
</div>
<h2 id="create-the-database-models">Create the database models<a class="headerlink" href="#create-the-database-models" title="Permanent link">&para;</a></h2>
<p>Let's now see the file <code>sql_app/models.py</code>.</p>
<h3 id="create-peewee-models-for-our-data">Create Peewee models for our data<a class="headerlink" href="#create-peewee-models-for-our-data" title="Permanent link">&para;</a></h3>
<p>Now create the Peewee models (classes) for <code>User</code> and <code>Item</code>.</p>
<p>This is the same you would do if you followed the Peewee tutorial and updated the models to have the same data as in the SQLAlchemy tutorial.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Peewee also uses the term "<strong>model</strong>" to refer to these classes and instances that interact with the database.</p>
<p>But Pydantic also uses the term "<strong>model</strong>" to refer to something different, the data validation, conversion, and documentation classes and instances.</p>
</div>
<p>Import <code>db</code> from <code>database</code> (the file <code>database.py</code> from above) and use it here.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">peewee</span>

<span class="hll"><span class="kn">from</span> <span class="nn">.database</span> <span class="kn">import</span> <span class="n">db</span>
</span>

<span class="hll"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">peewee</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="hll">    <span class="n">email</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="hll">    <span class="n">hashed_password</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
</span><span class="hll">    <span class="n">is_active</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class="hll">        <span class="n">database</span> <span class="o">=</span> <span class="n">db</span>
</span>

<span class="hll"><span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="n">peewee</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="hll">    <span class="n">title</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="hll">    <span class="n">description</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="hll">    <span class="n">owner</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;items&quot;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span><span class="hll">        <span class="n">database</span> <span class="o">=</span> <span class="n">db</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Peewee creates several magic attributes.</p>
<p>It will automatically add an <code>id</code> attribute as an integer to be the primary key.</p>
<p>It will chose the name of the tables based on the class names.</p>
<p>For the <code>Item</code>, it will create an attribute <code>owner_id</code> with the integer ID of the <code>User</code>. But we don't declare it anywhere.</p>
</div>
<h2 id="create-the-pydantic-models">Create the Pydantic models<a class="headerlink" href="#create-the-pydantic-models" title="Permanent link">&para;</a></h2>
<p>Now let's check the file <code>sql_app/schemas.py</code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To avoid confusion between the Peewee <em>models</em> and the Pydantic <em>models</em>, we will have the file <code>models.py</code> with the Peewee models, and the file <code>schemas.py</code> with the Pydantic models.</p>
<p>These Pydantic models define more or less a "schema" (a valid data shape).</p>
<p>So this will help us avoiding confusion while using both.</p>
</div>
<h3 id="create-the-pydantic-models-schemas">Create the Pydantic <em>models</em> / schemas<a class="headerlink" href="#create-the-pydantic-models-schemas" title="Permanent link">&para;</a></h3>
<p>Create all the same Pydantic models as in the SQLAlchemy tutorial:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">peewee</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span> <span class="nn">pydantic.utils</span> <span class="kn">import</span> <span class="n">GetterDict</span>


<span class="k">class</span> <span class="nc">PeeweeGetterDict</span><span class="p">(</span><span class="n">GetterDict</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">peewee</span><span class="o">.</span><span class="n">ModelSelect</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>


<span class="hll"><span class="k">class</span> <span class="nc">ItemBase</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span class="hll">    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
</span><span class="hll">    <span class="n">description</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span>

<span class="hll"><span class="k">class</span> <span class="nc">ItemCreate</span><span class="p">(</span><span class="n">ItemBase</span><span class="p">):</span>
</span><span class="hll">    <span class="k">pass</span>
</span>

<span class="hll"><span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="n">ItemBase</span><span class="p">):</span>
</span><span class="hll">    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
</span><span class="hll">    <span class="n">owner_id</span><span class="p">:</span> <span class="nb">int</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
</span><span class="hll">        <span class="n">orm_mode</span> <span class="o">=</span> <span class="kc">True</span>
</span>        <span class="n">getter_dict</span> <span class="o">=</span> <span class="n">PeeweeGetterDict</span>


<span class="hll"><span class="k">class</span> <span class="nc">UserBase</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span class="hll">    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span>
</span>

<span class="hll"><span class="k">class</span> <span class="nc">UserCreate</span><span class="p">(</span><span class="n">UserBase</span><span class="p">):</span>
</span><span class="hll">    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span>
</span>

<span class="hll"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">UserBase</span><span class="p">):</span>
</span><span class="hll">    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
</span><span class="hll">    <span class="n">is_active</span><span class="p">:</span> <span class="nb">bool</span>
</span><span class="hll">    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Item</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
</span><span class="hll">        <span class="n">orm_mode</span> <span class="o">=</span> <span class="kc">True</span>
</span>        <span class="n">getter_dict</span> <span class="o">=</span> <span class="n">PeeweeGetterDict</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Here we are creating the models with an <code>id</code>.</p>
<p>We didn't explicitly specify an <code>id</code> attribute in the Peewee models, but Peewee adds one automatically.</p>
<p>We are also adding the magic <code>owner_id</code> attribute to <code>Item</code>.</p>
</div>
<h3 id="create-a-peeweegetterdict-for-the-pydantic-models-schemas">Create a <code>PeeweeGetterDict</code> for the Pydantic <em>models</em> / schemas<a class="headerlink" href="#create-a-peeweegetterdict-for-the-pydantic-models-schemas" title="Permanent link">&para;</a></h3>
<p>When you access a relationship in a Peewee object, like in <code>some_user.items</code>, Peewee doesn't provide a <code>list</code> of <code>Item</code>.</p>
<p>It provides a special custom object of class <code>ModelSelect</code>.</p>
<p>It's possible to create a <code>list</code> of its items with <code>list(some_user.items)</code>.</p>
<p>But the object itself is not a <code>list</code>. And it's also not an actual Python <a href="https://docs.python.org/3/glossary.html#term-generator" class="external-link" target="_blank">generator</a>. Because of this, Pydantic doesn't know by default how to convert it to a <code>list</code> of Pydantic <em>models</em> / schemas.</p>
<p>But recent versions of Pydantic allow providing a custom class that inherits from <code>pydantic.utils.GetterDict</code>, to provide the functionality used when using the <code>orm_mode = True</code> to retrieve the values for ORM model attributes.</p>
<p>We are going to create a custom <code>PeeweeGetterDict</code> class and use it in all the same Pydantic <em>models</em> / schemas that use <code>orm_mode</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>

<span class="hll"><span class="kn">import</span> <span class="nn">peewee</span>
</span><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span> <span class="nn">pydantic.utils</span> <span class="kn">import</span> <span class="n">GetterDict</span>


<span class="hll"><span class="k">class</span> <span class="nc">PeeweeGetterDict</span><span class="p">(</span><span class="n">GetterDict</span><span class="p">):</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span class="hll">        <span class="n">res</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
</span><span class="hll">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">peewee</span><span class="o">.</span><span class="n">ModelSelect</span><span class="p">):</span>
</span><span class="hll">            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">res</span>
</span>

<span class="k">class</span> <span class="nc">ItemBase</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">class</span> <span class="nc">ItemCreate</span><span class="p">(</span><span class="n">ItemBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="n">ItemBase</span><span class="p">):</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">owner_id</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">orm_mode</span> <span class="o">=</span> <span class="kc">True</span>
<span class="hll">        <span class="n">getter_dict</span> <span class="o">=</span> <span class="n">PeeweeGetterDict</span>
</span>

<span class="k">class</span> <span class="nc">UserBase</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">UserCreate</span><span class="p">(</span><span class="n">UserBase</span><span class="p">):</span>
    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">UserBase</span><span class="p">):</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">is_active</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Item</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">orm_mode</span> <span class="o">=</span> <span class="kc">True</span>
<span class="hll">        <span class="n">getter_dict</span> <span class="o">=</span> <span class="n">PeeweeGetterDict</span>
</span></code></pre></div>
<p>Here we are checking if the attribute that is being accessed (e.g. <code>.items</code> in <code>some_user.items</code>) is an instance of <code>peewee.ModelSelect</code>.</p>
<p>And if that's the case, just return a <code>list</code> with it.</p>
<p>And then we use it in the Pydantic <em>models</em> / schemas that use <code>orm_mode = True</code>, with the configuration variable <code>getter_dict = PeeweeGetterDict</code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>We only need to create one <code>PeeweeGetterDict</code> class, and we can use it in all the Pydantic <em>models</em> / schemas.</p>
</div>
<h2 id="crud-utils">CRUD utils<a class="headerlink" href="#crud-utils" title="Permanent link">&para;</a></h2>
<p>Now let's see the file <code>sql_app/crud.py</code>.</p>
<h3 id="create-all-the-crud-utils">Create all the CRUD utils<a class="headerlink" href="#create-all-the-crud-utils" title="Permanent link">&para;</a></h3>
<p>Create all the same CRUD utils as in the SQLAlchemy tutorial, all the code is very similar:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">schemas</span>
</span>

<span class="hll"><span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span>

<span class="hll"><span class="k">def</span> <span class="nf">get_user_by_email</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">email</span> <span class="o">==</span> <span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span>

<span class="hll"><span class="k">def</span> <span class="nf">get_users</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
</span><span class="hll">    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">))</span>
</span>

<span class="hll"><span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">UserCreate</span><span class="p">):</span>
</span><span class="hll">    <span class="n">fake_hashed_password</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">password</span> <span class="o">+</span> <span class="s2">&quot;notreallyhashed&quot;</span>
</span><span class="hll">    <span class="n">db_user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">hashed_password</span><span class="o">=</span><span class="n">fake_hashed_password</span><span class="p">)</span>
</span><span class="hll">    <span class="n">db_user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">db_user</span>
</span>

<span class="hll"><span class="k">def</span> <span class="nf">get_items</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
</span><span class="hll">    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Item</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">))</span>
</span>

<span class="hll"><span class="k">def</span> <span class="nf">create_user_item</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">ItemCreate</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span class="hll">    <span class="n">db_item</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Item</span><span class="p">(</span><span class="o">**</span><span class="n">item</span><span class="o">.</span><span class="n">dict</span><span class="p">(),</span> <span class="n">owner_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
</span><span class="hll">    <span class="n">db_item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">db_item</span>
</span></code></pre></div>
<p>There are some differences with the code for the SQLAlchemy tutorial.</p>
<p>We don't pass a <code>db</code> attribute around. Instead we use the models directly. This is because the <code>db</code> object is a global object, that includes all the connection logic. That's why we had to do all the <code>contextvars</code> updates above.</p>
<p>Aso, when returning several objects, like in <code>get_users</code>, we directly call <code>list</code>, like in:</p>
<div class="highlight"><pre><span></span><code><span class="nb">list</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">())</span>
</code></pre></div>
<p>This is for the same reason that we had to create a custom <code>PeeweeGetterDict</code>. But by returning something that is already a <code>list</code> instead of the <code>peewee.ModelSelect</code> the <code>response_model</code> in the <em>path operation</em> with <code>List[models.User]</code> (that we'll see later) will work correctly.</p>
<h2 id="main-readyapi-app">Main <strong>ReadyAPI</strong> app<a class="headerlink" href="#main-readyapi-app" title="Permanent link">&para;</a></h2>
<p>And now in the file <code>sql_app/main.py</code> let's integrate and use all the other parts we created before.</p>
<h3 id="create-the-database-tables">Create the database tables<a class="headerlink" href="#create-the-database-tables" title="Permanent link">&para;</a></h3>
<p>In a very simplistic way create the database tables:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">readyapi</span> <span class="kn">import</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">HTTPException</span><span class="p">,</span> <span class="n">ReadyAPI</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">crud</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">schemas</span>
<span class="kn">from</span> <span class="nn">.database</span> <span class="kn">import</span> <span class="n">db_state_default</span>

<span class="hll"><span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</span><span class="hll"><span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">create_tables</span><span class="p">([</span><span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Item</span><span class="p">])</span>
</span><span class="hll"><span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">ReadyAPI</span><span class="p">()</span>

<span class="n">sleep_time</span> <span class="o">=</span> <span class="mi">10</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">reset_db_state</span><span class="p">():</span>
    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">db_state_default</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">get_db</span><span class="p">(</span><span class="n">db_state</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">reset_db_state</span><span class="p">)):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_closed</span><span class="p">():</span>
            <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/users/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">UserCreate</span><span class="p">):</span>
    <span class="n">db_user</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_user_by_email</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db_user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Email already registered&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">crud</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">read_users</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">users</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;/users/</span><span class="si">{user_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">read_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">db_user</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db_user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;User not found&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db_user</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="s2">&quot;/users/</span><span class="si">{user_id}</span><span class="s2">/items/&quot;</span><span class="p">,</span>
    <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">Item</span><span class="p">,</span>
    <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)],</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">create_item_for_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">ItemCreate</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">crud</span><span class="o">.</span><span class="n">create_user_item</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/items/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">Item</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">read_items</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">items</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;/slowusers/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">read_slow_users</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">sleep_time</span>
    <span class="n">sleep_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sleep_time</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>  <span class="c1"># Fake long processing request</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">users</span>
</code></pre></div>
<h3 id="create-a-dependency">Create a dependency<a class="headerlink" href="#create-a-dependency" title="Permanent link">&para;</a></h3>
<p>Create a dependency that will connect the database right at the beginning of a request and disconnect it at the end:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">readyapi</span> <span class="kn">import</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">HTTPException</span><span class="p">,</span> <span class="n">ReadyAPI</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">crud</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">schemas</span>
<span class="kn">from</span> <span class="nn">.database</span> <span class="kn">import</span> <span class="n">db_state_default</span>

<span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">create_tables</span><span class="p">([</span><span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Item</span><span class="p">])</span>
<span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">ReadyAPI</span><span class="p">()</span>

<span class="n">sleep_time</span> <span class="o">=</span> <span class="mi">10</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">reset_db_state</span><span class="p">():</span>
    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">db_state_default</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>


<span class="hll"><span class="k">def</span> <span class="nf">get_db</span><span class="p">(</span><span class="n">db_state</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">reset_db_state</span><span class="p">)):</span>
</span><span class="hll">    <span class="k">try</span><span class="p">:</span>
</span><span class="hll">        <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</span><span class="hll">        <span class="k">yield</span>
</span><span class="hll">    <span class="k">finally</span><span class="p">:</span>
</span><span class="hll">        <span class="k">if</span> <span class="ow">not</span> <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_closed</span><span class="p">():</span>
</span><span class="hll">            <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/users/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">UserCreate</span><span class="p">):</span>
    <span class="n">db_user</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_user_by_email</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db_user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Email already registered&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">crud</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">read_users</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">users</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;/users/</span><span class="si">{user_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">read_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">db_user</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db_user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;User not found&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db_user</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="s2">&quot;/users/</span><span class="si">{user_id}</span><span class="s2">/items/&quot;</span><span class="p">,</span>
    <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">Item</span><span class="p">,</span>
    <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)],</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">create_item_for_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">ItemCreate</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">crud</span><span class="o">.</span><span class="n">create_user_item</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/items/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">Item</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">read_items</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">items</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;/slowusers/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">read_slow_users</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">sleep_time</span>
    <span class="n">sleep_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sleep_time</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>  <span class="c1"># Fake long processing request</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">users</span>
</code></pre></div>
<p>Here we have an empty <code>yield</code> because we are actually not using the database object directly.</p>
<p>It is connecting to the database and storing the connection data in an internal variable that is independent for each request (using the <code>contextvars</code> tricks from above).</p>
<p>Because the database connection is potentially I/O blocking, this dependency is created with a normal <code>def</code> function.</p>
<p>And then, in each <em>path operation function</em> that needs to access the database we add it as a dependency.</p>
<p>But we are not using the value given by this dependency (it actually doesn't give any value, as it has an empty <code>yield</code>). So, we don't add it to the <em>path operation function</em> but to the <em>path operation decorator</em> in the <code>dependencies</code> parameter:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">readyapi</span> <span class="kn">import</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">HTTPException</span><span class="p">,</span> <span class="n">ReadyAPI</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">crud</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">schemas</span>
<span class="kn">from</span> <span class="nn">.database</span> <span class="kn">import</span> <span class="n">db_state_default</span>

<span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">create_tables</span><span class="p">([</span><span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Item</span><span class="p">])</span>
<span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">ReadyAPI</span><span class="p">()</span>

<span class="n">sleep_time</span> <span class="o">=</span> <span class="mi">10</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">reset_db_state</span><span class="p">():</span>
    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">db_state_default</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">get_db</span><span class="p">(</span><span class="n">db_state</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">reset_db_state</span><span class="p">)):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_closed</span><span class="p">():</span>
            <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="hll"><span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/users/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
</span><span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">UserCreate</span><span class="p">):</span>
    <span class="n">db_user</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_user_by_email</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db_user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Email already registered&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">crud</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>


<span class="hll"><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
</span><span class="k">def</span> <span class="nf">read_users</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">users</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<span class="hll">    <span class="s2">&quot;/users/</span><span class="si">{user_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)]</span>
</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">db_user</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db_user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;User not found&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db_user</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="s2">&quot;/users/</span><span class="si">{user_id}</span><span class="s2">/items/&quot;</span><span class="p">,</span>
    <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">Item</span><span class="p">,</span>
<span class="hll">    <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)],</span>
</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create_item_for_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">ItemCreate</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">crud</span><span class="o">.</span><span class="n">create_user_item</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>


<span class="hll"><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/items/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">Item</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
</span><span class="k">def</span> <span class="nf">read_items</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">items</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<span class="hll">    <span class="s2">&quot;/slowusers/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)]</span>
</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_slow_users</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">sleep_time</span>
    <span class="n">sleep_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sleep_time</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>  <span class="c1"># Fake long processing request</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">users</span>
</code></pre></div>
<h3 id="context-variable-sub-dependency">Context variable sub-dependency<a class="headerlink" href="#context-variable-sub-dependency" title="Permanent link">&para;</a></h3>
<p>For all the <code>contextvars</code> parts to work, we need to make sure we have an independent value in the <code>ContextVar</code> for each request that uses the database, and that value will be used as the database state (connection, transactions, etc) for the whole request.</p>
<p>For that, we need to create another <code>async</code> dependency <code>reset_db_state()</code> that is used as a sub-dependency in <code>get_db()</code>. It will set the value for the context variable (with just a default <code>dict</code>) that will be used as the database state for the whole request. And then the dependency <code>get_db()</code> will store in it the database state (connection, transactions, etc).</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">readyapi</span> <span class="kn">import</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">HTTPException</span><span class="p">,</span> <span class="n">ReadyAPI</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">crud</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">schemas</span>
<span class="kn">from</span> <span class="nn">.database</span> <span class="kn">import</span> <span class="n">db_state_default</span>

<span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">create_tables</span><span class="p">([</span><span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Item</span><span class="p">])</span>
<span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">ReadyAPI</span><span class="p">()</span>

<span class="n">sleep_time</span> <span class="o">=</span> <span class="mi">10</span>


<span class="hll"><span class="k">async</span> <span class="k">def</span> <span class="nf">reset_db_state</span><span class="p">():</span>
</span><span class="hll">    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">db_state_default</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span class="hll">    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span>

<span class="k">def</span> <span class="nf">get_db</span><span class="p">(</span><span class="n">db_state</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">reset_db_state</span><span class="p">)):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_closed</span><span class="p">():</span>
            <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/users/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">UserCreate</span><span class="p">):</span>
    <span class="n">db_user</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_user_by_email</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db_user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Email already registered&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">crud</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">read_users</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">users</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;/users/</span><span class="si">{user_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">read_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">db_user</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db_user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;User not found&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db_user</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="s2">&quot;/users/</span><span class="si">{user_id}</span><span class="s2">/items/&quot;</span><span class="p">,</span>
    <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">Item</span><span class="p">,</span>
    <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)],</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">create_item_for_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">ItemCreate</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">crud</span><span class="o">.</span><span class="n">create_user_item</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/items/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">Item</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">read_items</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">items</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;/slowusers/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">read_slow_users</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">sleep_time</span>
    <span class="n">sleep_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sleep_time</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>  <span class="c1"># Fake long processing request</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">users</span>
</code></pre></div>
<p>For the <strong>next request</strong>, as we will reset that context variable again in the <code>async</code> dependency <code>reset_db_state()</code> and then create a new connection in the <code>get_db()</code> dependency, that new request will have its own database state (connection, transactions, etc).</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>As ReadyAPI is an async framework, one request could start being processed, and before finishing, another request could be received and start processing as well, and it all could be processed in the same thread.</p>
<p>But context variables are aware of these async features, so, a Peewee database state set in the <code>async</code> dependency <code>reset_db_state()</code> will keep its own data throughout the entire request.</p>
<p>And at the same time, the other concurrent request will have its own database state that will be independent for the whole request.</p>
</div>
<h4 id="peewee-proxy">Peewee Proxy<a class="headerlink" href="#peewee-proxy" title="Permanent link">&para;</a></h4>
<p>If you are using a <a href="https://docs.peewee-orm.com/en/latest/peewee/database.html#dynamically-defining-a-database" class="external-link" target="_blank">Peewee Proxy</a>, the actual database is at <code>db.obj</code>.</p>
<p>So, you would reset it with:</p>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">reset_db_state</span><span class="p">():</span>
    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">db_state_default</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
<span class="hll">    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></code></pre></div>
<h3 id="create-your-readyapi-path-operations">Create your <strong>ReadyAPI</strong> <em>path operations</em><a class="headerlink" href="#create-your-readyapi-path-operations" title="Permanent link">&para;</a></h3>
<p>Now, finally, here's the standard <strong>ReadyAPI</strong> <em>path operations</em> code.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">readyapi</span> <span class="kn">import</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">HTTPException</span><span class="p">,</span> <span class="n">ReadyAPI</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">crud</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">schemas</span>
<span class="kn">from</span> <span class="nn">.database</span> <span class="kn">import</span> <span class="n">db_state_default</span>

<span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">create_tables</span><span class="p">([</span><span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Item</span><span class="p">])</span>
<span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">ReadyAPI</span><span class="p">()</span>

<span class="n">sleep_time</span> <span class="o">=</span> <span class="mi">10</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">reset_db_state</span><span class="p">():</span>
    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">db_state_default</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">get_db</span><span class="p">(</span><span class="n">db_state</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">reset_db_state</span><span class="p">)):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_closed</span><span class="p">():</span>
            <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="hll"><span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/users/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">UserCreate</span><span class="p">):</span>
</span><span class="hll">    <span class="n">db_user</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_user_by_email</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
</span><span class="hll">    <span class="k">if</span> <span class="n">db_user</span><span class="p">:</span>
</span><span class="hll">        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Email already registered&quot;</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">crud</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
</span>

<span class="hll"><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">read_users</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
</span><span class="hll">    <span class="n">users</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">users</span>
</span>

<span class="hll"><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span class="hll">    <span class="s2">&quot;/users/</span><span class="si">{user_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)]</span>
</span><span class="hll"><span class="p">)</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">read_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span class="hll">    <span class="n">db_user</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
</span><span class="hll">    <span class="k">if</span> <span class="n">db_user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span class="hll">        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;User not found&quot;</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">db_user</span>
</span>

<span class="hll"><span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span class="hll">    <span class="s2">&quot;/users/</span><span class="si">{user_id}</span><span class="s2">/items/&quot;</span><span class="p">,</span>
</span><span class="hll">    <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">Item</span><span class="p">,</span>
</span><span class="hll">    <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)],</span>
</span><span class="hll"><span class="p">)</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">create_item_for_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">ItemCreate</span><span class="p">):</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">crud</span><span class="o">.</span><span class="n">create_user_item</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
</span>

<span class="hll"><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/items/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">Item</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">read_items</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
</span><span class="hll">    <span class="n">items</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">items</span>
</span>

<span class="hll"><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span class="hll">    <span class="s2">&quot;/slowusers/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)]</span>
</span><span class="hll"><span class="p">)</span>
</span><span class="hll"><span class="k">def</span> <span class="nf">read_slow_users</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
</span><span class="hll">    <span class="k">global</span> <span class="n">sleep_time</span>
</span><span class="hll">    <span class="n">sleep_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sleep_time</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span class="hll">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>  <span class="c1"># Fake long processing request</span>
</span><span class="hll">    <span class="n">users</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="n">users</span>
</span></code></pre></div>
<h3 id="about-def-vs-async-def">About <code>def</code> vs <code>async def</code><a class="headerlink" href="#about-def-vs-async-def" title="Permanent link">&para;</a></h3>
<p>The same as with SQLAlchemy, we are not doing something like:</p>
<div class="highlight"><pre><span></span><code><span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</code></pre></div>
<p>...but instead we are using:</p>
<div class="highlight"><pre><span></span><code><span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</code></pre></div>
<p>So, again, we should declare the <em>path operation functions</em> and the dependency without <code>async def</code>, just with a normal <code>def</code>, as:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Something goes here</span>
<span class="hll"><span class="k">def</span> <span class="nf">read_users</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
</span>    <span class="c1"># Something goes here</span>
</code></pre></div>
<h2 id="testing-peewee-with-async">Testing Peewee with async<a class="headerlink" href="#testing-peewee-with-async" title="Permanent link">&para;</a></h2>
<p>This example includes an extra <em>path operation</em> that simulates a long processing request with <code>time.sleep(sleep_time)</code>.</p>
<p>It will have the database connection open at the beginning and will just wait some seconds before replying back. And each new request will wait one second less.</p>
<p>This will easily let you test that your app with Peewee and ReadyAPI is behaving correctly with all the stuff about threads.</p>
<p>If you want to check how Peewee would break your app if used without modification, go the <code>sql_app/database.py</code> file and comment the line:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># db._state = PeeweeConnectionState()</span>
</code></pre></div>
<p>And in the file <code>sql_app/main.py</code> file, comment the body of the <code>async</code> dependency <code>reset_db_state()</code> and replace it with a <code>pass</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">reset_db_state</span><span class="p">():</span>
<span class="c1">#     database.db._state._state.set(db_state_default.copy())</span>
<span class="c1">#     database.db._state.reset()</span>
    <span class="k">pass</span>
</code></pre></div>
<p>Then run your app with Uvicorn:</p>
<div class="termy">

<div class="highlight"><pre><span></span><code><span class="gp">$ </span>uvicorn<span class="w"> </span>sql_app.main:app<span class="w"> </span>--reload

<span class="go">&lt;span style=&quot;color: green;&quot;&gt;INFO&lt;/span&gt;:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)</span>
</code></pre></div>

</div>

<p>Open your browser at <a href="http://127.0.0.1:8000/docs" class="external-link" target="_blank">http://127.0.0.1:8000/docs</a>  and create a couple of users.</p>
<p>Then open 10 tabs at <a href="http://127.0.0.1:8000/docs#/default/read_slow_users_slowusers__get" class="external-link" target="_blank">http://127.0.0.1:8000/docs#/default/read_slow_users_slowusers__get</a> at the same time.</p>
<p>Go to the <em>path operation</em> "Get <code>/slowusers/</code>" in all of the tabs. Use the "Try it out" button and execute the request in each tab, one right after the other.</p>
<p>The tabs will wait for a bit and then some of them will show <code>Internal Server Error</code>.</p>
<h3 id="what-happens">What happens<a class="headerlink" href="#what-happens" title="Permanent link">&para;</a></h3>
<p>The first tab will make your app create a connection to the database and wait for some seconds before replying back and closing the database connection.</p>
<p>Then, for the request in the next tab, your app will wait for one second less, and so on.</p>
<p>This means that it will end up finishing some of the last tabs' requests earlier than some of the previous ones.</p>
<p>Then one the last requests that wait less seconds will try to open a database connection, but as one of those previous requests for the other tabs will probably be handled in the same thread as the first one, it will have the same database connection that is already open, and Peewee will throw an error and you will see it in the terminal, and the response will have an <code>Internal Server Error</code>.</p>
<p>This will probably happen for more than one of those tabs.</p>
<p>If you had multiple clients talking to your app exactly at the same time, this is what could happen.</p>
<p>And as your app starts to handle more and more clients at the same time, the waiting time in a single request needs to be shorter and shorter to trigger the error.</p>
<h3 id="fix-peewee-with-readyapi">Fix Peewee with ReadyAPI<a class="headerlink" href="#fix-peewee-with-readyapi" title="Permanent link">&para;</a></h3>
<p>Now go back to the file <code>sql_app/database.py</code>, and uncomment the line:</p>
<div class="highlight"><pre><span></span><code><span class="n">db</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">PeeweeConnectionState</span><span class="p">()</span>
</code></pre></div>
<p>And in the file <code>sql_app/main.py</code> file, uncomment the body of the <code>async</code> dependency <code>reset_db_state()</code>:</p>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">reset_db_state</span><span class="p">():</span>
    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">db_state_default</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</code></pre></div>
<p>Terminate your running app and start it again.</p>
<p>Repeat the same process with the 10 tabs. This time all of them will wait and you will get all the results without errors.</p>
<p>...You fixed it!</p>
<h2 id="review-all-the-files">Review all the files<a class="headerlink" href="#review-all-the-files" title="Permanent link">&para;</a></h2>
<p>Remember you should have a directory named <code>my_super_project</code> (or however you want) that contains a sub-directory called <code>sql_app</code>.</p>
<p><code>sql_app</code> should have the following files:</p>
<ul>
<li>
<p><code>sql_app/__init__.py</code>: is an empty file.</p>
</li>
<li>
<p><code>sql_app/database.py</code>:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">contextvars</span> <span class="kn">import</span> <span class="n">ContextVar</span>

<span class="kn">import</span> <span class="nn">peewee</span>

<span class="n">DATABASE_NAME</span> <span class="o">=</span> <span class="s2">&quot;test.db&quot;</span>
<span class="n">db_state_default</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;closed&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;conn&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;ctx&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;transactions&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
<span class="n">db_state</span> <span class="o">=</span> <span class="n">ContextVar</span><span class="p">(</span><span class="s2">&quot;db_state&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">db_state_default</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">PeeweeConnectionState</span><span class="p">(</span><span class="n">peewee</span><span class="o">.</span><span class="n">_ConnectionState</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_state&quot;</span><span class="p">,</span> <span class="n">db_state</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span>


<span class="n">db</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">SqliteDatabase</span><span class="p">(</span><span class="n">DATABASE_NAME</span><span class="p">,</span> <span class="n">check_same_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">db</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">PeeweeConnectionState</span><span class="p">()</span>
</code></pre></div>
<ul>
<li><code>sql_app/models.py</code>:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">peewee</span>

<span class="kn">from</span> <span class="nn">.database</span> <span class="kn">import</span> <span class="n">db</span>


<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">peewee</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">hashed_password</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">is_active</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">db</span>


<span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="n">peewee</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">peewee</span><span class="o">.</span><span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;items&quot;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">db</span>
</code></pre></div>
<ul>
<li><code>sql_app/schemas.py</code>:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">peewee</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span> <span class="nn">pydantic.utils</span> <span class="kn">import</span> <span class="n">GetterDict</span>


<span class="k">class</span> <span class="nc">PeeweeGetterDict</span><span class="p">(</span><span class="n">GetterDict</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">peewee</span><span class="o">.</span><span class="n">ModelSelect</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>


<span class="k">class</span> <span class="nc">ItemBase</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">class</span> <span class="nc">ItemCreate</span><span class="p">(</span><span class="n">ItemBase</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="n">ItemBase</span><span class="p">):</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">owner_id</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">orm_mode</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">getter_dict</span> <span class="o">=</span> <span class="n">PeeweeGetterDict</span>


<span class="k">class</span> <span class="nc">UserBase</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">UserCreate</span><span class="p">(</span><span class="n">UserBase</span><span class="p">):</span>
    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">UserBase</span><span class="p">):</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">is_active</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Item</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">orm_mode</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">getter_dict</span> <span class="o">=</span> <span class="n">PeeweeGetterDict</span>
</code></pre></div>
<ul>
<li><code>sql_app/crud.py</code>:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">schemas</span>


<span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">get_user_by_email</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">email</span> <span class="o">==</span> <span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">get_users</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">UserCreate</span><span class="p">):</span>
    <span class="n">fake_hashed_password</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">password</span> <span class="o">+</span> <span class="s2">&quot;notreallyhashed&quot;</span>
    <span class="n">db_user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">hashed_password</span><span class="o">=</span><span class="n">fake_hashed_password</span><span class="p">)</span>
    <span class="n">db_user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">db_user</span>


<span class="k">def</span> <span class="nf">get_items</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Item</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">create_user_item</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">ItemCreate</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">db_item</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Item</span><span class="p">(</span><span class="o">**</span><span class="n">item</span><span class="o">.</span><span class="n">dict</span><span class="p">(),</span> <span class="n">owner_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
    <span class="n">db_item</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">db_item</span>
</code></pre></div>
<ul>
<li><code>sql_app/main.py</code>:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">readyapi</span> <span class="kn">import</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">HTTPException</span><span class="p">,</span> <span class="n">ReadyAPI</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">crud</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">schemas</span>
<span class="kn">from</span> <span class="nn">.database</span> <span class="kn">import</span> <span class="n">db_state_default</span>

<span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">create_tables</span><span class="p">([</span><span class="n">models</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">Item</span><span class="p">])</span>
<span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">ReadyAPI</span><span class="p">()</span>

<span class="n">sleep_time</span> <span class="o">=</span> <span class="mi">10</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">reset_db_state</span><span class="p">():</span>
    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">db_state_default</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">get_db</span><span class="p">(</span><span class="n">db_state</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">reset_db_state</span><span class="p">)):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_closed</span><span class="p">():</span>
            <span class="n">database</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/users/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">UserCreate</span><span class="p">):</span>
    <span class="n">db_user</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_user_by_email</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db_user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Email already registered&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">crud</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">read_users</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">users</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;/users/</span><span class="si">{user_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">read_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">db_user</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db_user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;User not found&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db_user</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="s2">&quot;/users/</span><span class="si">{user_id}</span><span class="s2">/items/&quot;</span><span class="p">,</span>
    <span class="n">response_model</span><span class="o">=</span><span class="n">schemas</span><span class="o">.</span><span class="n">Item</span><span class="p">,</span>
    <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)],</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">create_item_for_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">schemas</span><span class="o">.</span><span class="n">ItemCreate</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">crud</span><span class="o">.</span><span class="n">create_user_item</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/items/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">Item</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">read_items</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_items</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">items</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;/slowusers/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">schemas</span><span class="o">.</span><span class="n">User</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">)]</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">read_slow_users</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">sleep_time</span>
    <span class="n">sleep_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sleep_time</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>  <span class="c1"># Fake long processing request</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">crud</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">users</span>
</code></pre></div>
<h2 id="technical-details">Technical Details<a class="headerlink" href="#technical-details" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>These are very technical details that you probably don't need.</p>
</div>
<h3 id="the-problem">The problem<a class="headerlink" href="#the-problem" title="Permanent link">&para;</a></h3>
<p>Peewee uses <a href="https://docs.python.org/3/library/threading.html#thread-local-data" class="external-link" target="_blank"><code>threading.local</code></a> by default to store it's database "state" data (connection, transactions, etc).</p>
<p><code>threading.local</code> creates a value exclusive to the current thread, but an async framework would run all the code (e.g. for each request) in the same thread, and possibly not in order.</p>
<p>On top of that, an async framework could run some sync code in a threadpool (using <code>asyncio.run_in_executor</code>), but belonging to the same request.</p>
<p>This means that, with Peewee's current implementation, multiple tasks could be using the same <code>threading.local</code> variable and end up sharing the same connection and data (that they shouldn't), and at the same time, if they execute sync I/O-blocking code in a threadpool (as with normal <code>def</code> functions in ReadyAPI, in <em>path operations</em>  and dependencies), that code won't have access to the database state variables, even while it's part of the same request and it should be able to get access to the same database state.</p>
<h3 id="context-variables">Context variables<a class="headerlink" href="#context-variables" title="Permanent link">&para;</a></h3>
<p>Python 3.7 has <a href="https://docs.python.org/3/library/contextvars.html" class="external-link" target="_blank"><code>contextvars</code></a> that can create a local variable very similar to <code>threading.local</code>, but also supporting these async features.</p>
<p>There are several things to keep in mind.</p>
<p>The <code>ContextVar</code> has to be created at the top of the module, like:</p>
<div class="highlight"><pre><span></span><code><span class="n">some_var</span> <span class="o">=</span> <span class="n">ContextVar</span><span class="p">(</span><span class="s2">&quot;some_var&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;default value&quot;</span><span class="p">)</span>
</code></pre></div>
<p>To set a value used in the current "context" (e.g. for the current request) use:</p>
<div class="highlight"><pre><span></span><code><span class="n">some_var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;new value&quot;</span><span class="p">)</span>
</code></pre></div>
<p>To get a value anywhere inside of the context (e.g. in any part handling the current request) use:</p>
<div class="highlight"><pre><span></span><code><span class="n">some_var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</code></pre></div>
<h3 id="set-context-variables-in-the-async-dependency-reset_db_state">Set context variables in the <code>async</code> dependency <code>reset_db_state()</code><a class="headerlink" href="#set-context-variables-in-the-async-dependency-reset_db_state" title="Permanent link">&para;</a></h3>
<p>If some part of the async code sets the value with <code>some_var.set("updated in function")</code> (e.g. like the <code>async</code> dependency), the rest of the code in it and the code that goes after (including code inside of <code>async</code> functions called with <code>await</code>) will see that new value.</p>
<p>So, in our case, if we set the Peewee state variable (with a default <code>dict</code>) in the <code>async</code> dependency, all the rest of the internal code in our app will see this value and will be able to reuse it for the whole request.</p>
<p>And the context variable would be set again for the next request, even if they are concurrent.</p>
<h3 id="set-database-state-in-the-dependency-get_db">Set database state in the dependency <code>get_db()</code><a class="headerlink" href="#set-database-state-in-the-dependency-get_db" title="Permanent link">&para;</a></h3>
<p>As <code>get_db()</code> is a normal <code>def</code> function, <strong>ReadyAPI</strong> will make it run in a threadpool, with a <em>copy</em> of the "context", holding the same value for the context variable (the <code>dict</code> with the reset database state). Then it can add database state to that <code>dict</code>, like the connection, etc.</p>
<p>But if the value of the context variable (the default <code>dict</code>) was set in that normal <code>def</code> function, it would create a new value that would stay only in that thread of the threadpool, and the rest of the code (like the <em>path operation functions</em>) wouldn't have access to it. In <code>get_db()</code> we can only set values in the <code>dict</code>, but not the entire <code>dict</code> itself.</p>
<p>So, we need to have the <code>async</code> dependency <code>reset_db_state()</code> to set the <code>dict</code> in the context variable. That way, all the code has access to the same <code>dict</code> for the database state for a single request.</p>
<h3 id="connect-and-disconnect-in-the-dependency-get_db">Connect and disconnect in the dependency <code>get_db()</code><a class="headerlink" href="#connect-and-disconnect-in-the-dependency-get_db" title="Permanent link">&para;</a></h3>
<p>Then the next question would be, why not just connect and disconnect the database in the <code>async</code> dependency itself, instead of in <code>get_db()</code>?</p>
<p>The <code>async</code> dependency has to be <code>async</code> for the context variable to be preserved for the rest of the request, but creating and closing the database connection is potentially blocking, so it could degrade performance if it was there.</p>
<p>So we also need the normal <code>def</code> dependency <code>get_db()</code>.</p>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
    <div class="md-copyright__highlight">
        The ReadyAPI trademark is owned by <a href="https://khulnasoft.com" target="_blank">@khulnasoft</a> and is registered in the US and across other regions
    </div>
    
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
        Material for MkDocs
    </a>
    
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/khulnasoft/readyapi" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://discord.gg/VQjSZaeJmf" target="_blank" rel="noopener" title="discord.gg" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/readyapi" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/khulnasoft" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://dev.to/khulnasoft" target="_blank" rel="noopener" title="dev.to" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://medium.com/@khulnasoft" target="_blank" rel="noopener" title="medium.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M180.5 74.262C80.813 74.262 0 155.633 0 256s80.819 181.738 180.5 181.738S361 356.373 361 256 280.191 74.262 180.5 74.262Zm288.25 10.646c-49.845 0-90.245 76.619-90.245 171.095s40.406 171.1 90.251 171.1 90.251-76.619 90.251-171.1H559c0-94.503-40.4-171.095-90.248-171.095Zm139.506 17.821c-17.526 0-31.735 68.628-31.735 153.274s14.2 153.274 31.735 153.274S640 340.631 640 256c0-84.649-14.215-153.271-31.742-153.271Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://khulnasoft.com" target="_blank" rel="noopener" title="khulnasoft.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M352 256c0 22.2-1.2 43.6-3.3 64H163.3c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64h185.4c2.2 20.4 3.3 41.8 3.3 64zm28.8-64h123.1c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64H380.8c2.1-20.6 3.2-42 3.2-64s-1.1-43.4-3.2-64zm112.6-32H376.7c-10-63.9-29.8-117.4-55.3-151.6 78.3 20.7 142 77.5 171.9 151.6zm-149.1 0H167.7c6.1-36.4 15.5-68.6 27-94.7 10.5-23.6 22.2-40.7 33.5-51.5C239.4 3.2 248.7 0 256 0s16.6 3.2 27.8 13.8c11.3 10.8 23 27.9 33.5 51.5 11.6 26 20.9 58.2 27 94.7zm-209 0H18.6c30-74.1 93.6-130.9 172-151.6-25.5 34.2-45.3 87.7-55.3 151.6zM8.1 192h123.1c-2.1 20.6-3.2 42-3.2 64s1.1 43.4 3.2 64H8.1C2.8 299.5 0 278.1 0 256s2.8-43.5 8.1-64zm186.6 254.6c-11.6-26-20.9-58.2-27-94.6h176.6c-6.1 36.4-15.5 68.6-27 94.6-10.5 23.6-22.2 40.7-33.5 51.5-11.2 10.7-20.5 13.9-27.8 13.9s-16.6-3.2-27.8-13.8c-11.3-10.8-23-27.9-33.5-51.5zM135.3 352c10 63.9 29.8 117.4 55.3 151.6-78.4-20.7-142-77.5-172-151.6h116.7zm358.1 0c-30 74.1-93.6 130.9-171.9 151.6 25.5-34.2 45.2-87.7 55.3-151.6h116.6z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["search.suggest", "search.highlight", "content.tabs.link", "navigation.indexes", "content.tooltips", "navigation.path", "content.code.annotate", "content.code.copy", "content.code.select", "navigation.tabs"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "In Zwischenablage kopiert", "clipboard.copy": "In Zwischenablage kopieren", "search.result.more.one": "1 weiteres Suchergebnis auf dieser Seite", "search.result.more.other": "# weitere Suchergebnisse auf dieser Seite", "search.result.none": "Keine Suchergebnisse", "search.result.one": "1 Suchergebnis", "search.result.other": "# Suchergebnisse", "search.result.placeholder": "Suchbegriff eingeben", "search.result.term.missing": "Es fehlt", "select.version": "Version ausw\u00e4hlen"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.3220b9d7.min.js"></script>
      
        <script src="../../js/termynal.js"></script>
      
        <script src="../../js/custom.js"></script>
      
    
  </body>
</html>